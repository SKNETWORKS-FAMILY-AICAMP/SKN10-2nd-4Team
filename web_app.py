import os
import streamlit as st
import pandas as pd
import joblib

# âœ… í”„ë¡œì íŠ¸ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ ì„¤ì •
BASE_DIR = os.path.dirname(os.path.abspath(__file__))

# ğŸ“Œ ëª¨ë¸ ë¡œë“œ í•¨ìˆ˜
@st.cache_resource
def load_model(model_type="rf"):
    return joblib.load(f"model/final_model_{model_type}.pkl")

# ğŸ“Œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° í•¨ìˆ˜ (CSV í™œìš©)
@st.cache_data
def load_data():
    csv_path = os.path.join(BASE_DIR, "data", "clustered_Customer_Churn.csv")  # CSV íŒŒì¼ ê²½ë¡œ
    df = pd.read_csv(csv_path)
    return df

# ğŸ“Œ Streamlit í˜ì´ì§€ ì„¤ì •
st.set_page_config(page_title="Customer Churn Prediction", layout="wide")

# # ğŸ“Œ ì‚¬ì´ë“œë°” ë©”ë‰´ (Streamlit ê¸°ë³¸ ë‹¤ì¤‘ í˜ì´ì§€ ì§€ì›)
# st.sidebar.title("ğŸ”— í˜ì´ì§€ ì´ë™")

# ğŸ“Œ ë©”ì¸ í˜ì´ì§€ ë‚´ìš©
st.title("ğŸ’¡ ê³ ê° ì´íƒˆ ì˜ˆì¸¡ ì‹œìŠ¤í…œ")
st.write("""
ë³¸ ì‹œìŠ¤í…œì€ **ê³ ê° ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ ì´íƒˆ ê°€ëŠ¥ì„±ì„ ì˜ˆì¸¡**í•˜ê³ ,  
ê¸ˆìœµìƒí’ˆì„ í™œìš©í•˜ì—¬ ì´íƒˆë¥ ì„ ì¤„ì´ëŠ” ì‹œë®¬ë ˆì´ì…˜ì„ ì œê³µí•©ë‹ˆë‹¤.
""")

st.write("### ğŸ“Œ í”„ë¡œì íŠ¸ ê°œìš”")
st.image("streamlit/img/main_page.jpg", caption="ê³ ê° ì´íƒˆ ì˜ˆì¸¡ í”„ë¡œì íŠ¸ íë¦„ë„")

st.write("""
**ğŸ“Œ í”„ë¡œì íŠ¸ ê°œìš”**  
SKN Bankì˜ CEOëŠ” ê³ ê° ì´íƒˆë¥ ì„ ì¤„ì´ê¸° ìœ„í•œ ë°©ì•ˆì„ ìš”êµ¬í•˜ê³  ìˆìŠµë‹ˆë‹¤.  
ìš°ë¦¬ëŠ” SKN Bankì‚¬ì˜ ë°ì´í„° ì‚¬ì´ì–¸í‹°ìŠ¤íŠ¸ ë”¤ìœ¼ë¡œ **ê³ ê° ë°ì´í„°ë¥¼ ë¶„ì„**í•˜ì—¬ ì´íƒˆ íŒ¨í„´ì„ ì°¾ê³ , **íš¨ìœ¨ì ì¸ ì „ëµ**ì„ ì ìš©í•  ê²ƒì…ë‹ˆë‹¤.
""")

# ğŸ“Œ CEO ìš”êµ¬ì‚¬í•­ ë²„íŠ¼
if st.button("ğŸ“Œ CEOì˜ ìš”êµ¬ì‚¬í•­ ë³´ê¸°"):
    st.subheader("ğŸ‘¨â€ğŸ’¼ CEOì˜ ìš”êµ¬ ì‚¬í•­")
    st.markdown("""
    **ê³ ê° ì´íƒˆë¥ ì„ ë¶„ì„í•˜ê³  ì¤„ì¼ ë°©ë²•ì„ ì°¾ì•„ë¼.**
    """)

# ğŸ“Œ ë¶„ì„ ê³¼ì • ë²„íŠ¼
if st.button("ğŸ“Š ë¶„ì„ ê³¼ì • ë³´ê¸°"):
    st.header("ğŸ“Š ë¶„ì„ ê³¼ì •")

    st.subheader("1ï¸âƒ£ ì´íƒˆë¥ ì„ ì–´ë–»ê²Œ ë¶„ì„í•  ê²ƒì¸ê°€?")
    st.write("""
    - **ê³ ê° ë°ì´í„°ë¥¼ êµ°ì§‘í™”í•˜ì—¬ ìœ í˜• ë¶„ë¥˜**
    - **êµ°ì§‘ íŠ¹ì„±ì„ ë°”íƒ•ìœ¼ë¡œ ì´íƒˆ ê°€ëŠ¥ì„±ì„ ì˜ˆì¸¡**í•´ë³´ëŠ”ê±´ ì–´ë–¨ê¹Œ?
    """)

    st.subheader("2ï¸âƒ£ í´ëŸ¬ìŠ¤í„°ë§ ë°©ì‹ ì„ íƒ")
    st.write("""
    - **ì—˜ë³´ ê¸°ë²•(Elbow Method)ê³¼ ì‹¤ë£¨ì—£ ë¶„ì„(Silhouette Analysis)ì„ ì ìš©í•˜ì—¬ ìµœì  êµ°ì§‘ 4ê°œ**
    """)
    # ğŸ“Œ í´ëŸ¬ìŠ¤í„°ë§ ìµœì í™” ì´ë¯¸ì§€ ì¶”ê°€
    cluster_image_path = os.path.join(BASE_DIR, "streamlit/img", "OptimizeCluster.jpg")
    st.image(cluster_image_path, caption="í´ëŸ¬ìŠ¤í„°ë§ ìµœì í™” ë¶„ì„ ê²°ê³¼", use_container_width=True)
    st.write("""
    - but 4ê°œ êµ°ì§‘ì„ ê³ ë ¤í–ˆìœ¼ë‚˜, **ì„¸ë¶€ ìœ í˜• ë¶„ë¥˜ê°€ ì–´ë µë‹¤ê³  íŒë‹¨**
    - ìµœì¢…ì ìœ¼ë¡œ **6ê°œ í´ëŸ¬ìŠ¤í„°ë¡œ ë¶„ë¥˜**
    """)
    # ğŸ“Œ í´ëŸ¬ìŠ¤í„° í”¼ì³ ì´ë¯¸ì§€ ì¶”ê°€
    ClusterFeature_image_path = os.path.join(BASE_DIR, "streamlit/img", "ClusterFeature.jpg")
    st.image(ClusterFeature_image_path, caption="í´ëŸ¬ìŠ¤í„° íŠ¹ì§•", use_container_width=True)


if st.button("ğŸ›  êµ°ì§‘ ë¶„ì„"):
    st.subheader("íƒ€ê²Ÿ êµ°ì§‘ ì„ íƒ")
    cluster_image_path = os.path.join(BASE_DIR, "streamlit/img", "ClusterStrategy.jpg")
    st.image(cluster_image_path, caption="í´ëŸ¬ìŠ¤í„° ì „ëµëµ", use_container_width=True)    
    st.write("""
    - ëª¨ë“  ê³ ê°ì˜ ì´íƒˆë¥ ì„ ì¤„ì´ëŠ” ê²ƒì€ **ë¹„ìš©ê³¼ ì‹œê°„** ì¸¡ë©´ì—ì„œ ë¹„íš¨ìœ¨ì , ê¸ˆìœµìƒí’ˆ ì œê³µì‹œ **ê°€ì¥ íš¨ê³¼ì ì¸ êµ°ì§‘**ì„ ì„ ì •.
    - **í´ëŸ¬ìŠ¤í„° 1ë²ˆê³¼ 2ë²ˆ**: ì€í–‰ì˜ í•µì‹¬ ìƒí’ˆ ì „ëµê³¼ ì—°ê´€ì„±ì´ ë‚®ìœ¼ë©°, ì´íƒˆ ë°©ì§€ë¥¼ ìœ„í•œ ë¹„ìš©ì´ ìƒëŒ€ì ìœ¼ë¡œ í´ ê°€ëŠ¥ì„±ì´ ë†’ìŒ.
    - **í´ëŸ¬ìŠ¤í„° 4ë²ˆ(ê³ ë ¹ì¸µ)**: ê¸ˆìœµí™œë™ì´ ì •ì²´ë˜ì—ˆì„ ê°€ëŠ¥ì„±ì´ ì»¤ ì ê·¹ì ì¸ ë§ˆì¼€íŒ… íš¨ê³¼ê°€ ì œí•œì ì„.
    - **í´ëŸ¬ìŠ¤í„° 5ë²ˆ(ì Šì€ ê³ ê°ì¸µ)**ì€ **ì¥ê¸°ì ì¸ ê³ ê° ìœ ì¹˜ ì „ëµ**ì´ í•„ìš”í•˜ì§€ë§Œ, ë‹¨ê¸°ê°„(1~2ë…„) ë‚´ ì„±ê³¼ë¥¼ ë‚´ê¸° ì–´ë ¤ì›€
    - **í´ëŸ¬ìŠ¤í„° 0ë²ˆê³¼ 3ë²ˆ**: **ì´ í’ë¶€í•˜ë©°, **ê¸ˆìœµ ìƒí’ˆì— ëŒ€í•œ ë°˜ì‘ë„**ê°€ ë†’ì•„ íš¨ê³¼ì ì¸ ë§ˆì¼€íŒ… ë° ìƒí’ˆ ì „ëµ ì ìš©ì´ ê°€ëŠ¥í•¨.
    """)
